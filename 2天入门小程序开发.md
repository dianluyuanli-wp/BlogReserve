# 前言
&emsp;&emsp;当下的前端业态正在朝多端化发展，小程序和诸多跨平台的架构(ReactNative、Weex、Flutter)开发逐渐成为大公司的必备选项。作为前端从业者，除了传统的web开发工具集，我们也需要掌握一定的跨端开发能力，以适应技术潮流的发展。在此我将通过一个简单的例子，展示微信小程序的基本开发流程。

# 小程序开发概述
## 小程序优缺点
&emsp;&emsp;作为一个有一定学习门槛的新平台，小程序必然要给我们带来一定的收益才能说服程序员们啃这块骨头。
* 小程序首先是一个半原生的平台，能够通过微信app作为中间层,调用部分原生的接口，你能想像仅使用js来实现扫描二维码的功能吗？通过调用微信小程序封装好的api,开发者可以十分方便地使用一些常用功能，比如地图定位，搜索等等，还可以通过使用小程序内置的各种组件，直接让用户获取类似于原生的体验，同时也不用担心在android和ios系统下的兼容性问题。
* 微信是当下中国最具国民性的应用。小程序作为微信的亲儿子，天然具有引流属性，与用户更近，你很难想象用户为了一些十分简单的需求而去专门下载一个app，而h5在使用智能手机原生特性上有先天不足，同样不适合微应用场景。小程序灵活轻便，即用即丢。小程序的功能通常能够满足绝大多数公司的需求，作为微信生态的重要组成部分，小程序自带用户验证，微信支付等重要入口，接入简单，极大降低了开发成本。

&emsp;&emsp;所有的优缺点都是相对于特定的应用场景而言的。小程序有什么样的不足呢？
* 与传统js开发不同，小程序使用双线程的架构，小程序的逻辑部分和渲染部分是分成两个线程的，二者之间的状态和UI同步具有一定的成本，在某些极端情况下存在性能瓶颈（比如超长列表的状态刷新），同时由于它的小，必然不可能实现十分复杂的功能，普通微信小程序的主包大小不能超过2M,哪怕采取分包策略，打包后的体积也是有上线的。
* 由于背靠微信，就意味着必然受到微信官方平台的很多限制，在获取用户信息上被严格限制，很多好用的api只对微信自己或者部分大厂开放，普通开发者不能调用(个人注册的小程序甚至不能使用webView)，开发的灵活性收到很大限制(既想享受原生的体验，又想避免跨平台的兼容问题，笔者推荐flutter,后续也会出相关的文，待更)。

&emsp;&emsp;闲言少叙，我们接下来进入实战环节。

# 准备开发环境、了解项目结构
&emsp;&emsp;首先下载[微信小程序开发者套件](https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html)，目前仅支持macOS和windows系统。下载完毕后进行安装，打开开发者工具，新建一个项目,此时要填写AppId,我们可以直接选择点击测试号，进入下一步，如果要开发自己的上线小程序，就需要在微信公共平台注册自己的小程序id,填写在AppId处：
![](https://user-gold-cdn.xitu.io/2019/11/7/16e45e005760efc7?w=816&h=551&f=png&s=54441)  
新建项目后，会得到如下界面，这是一个小程序的默认项目，大家可以先体验下代码：
![编辑器面板](https://user-gold-cdn.xitu.io/2019/11/7/16e45ddc1c949f8e?w=1034&h=1060&f=png&s=111197)

&emsp;&emsp;微信小程序的开发基于js(现也支持TypeScript),代码的组织方式十分类似Vue，开发流程类似标准的前端工作流,即js+html+css。不过在微信小程序里面，微信使用wxml文件替换html文件，wxss替换css文件，分别控制小程序的文档流和对应样式。我们首先来观察下项目的目录机构：  
![项目结构](https://user-gold-cdn.xitu.io/2019/11/8/16e4ae75f7a6f1de?w=213&h=335&f=png&s=12259)  
&emsp;&emsp;以app开头的文件是项目的入口文件，必须在项目的根目录下。app.js为项目的代码逻辑入口，app.json则放置项目的公共配置，这两个都是必须存在的文件，app.wxss控制项目的公共样式，是可选项。project.config.json是项目的配置文件，sitemap.json用来配置小程序及其页面是否能被微信索引。
我们首先查看app.js文件：
```
//app.js
App({
  onLaunch (options) {
    // Do something initial when launch.
  },
  onShow (options) {
    // Do something when show.
  },
  onHide () {
    // Do something when hide.
  },
  onError (msg) {
    console.log(msg)
  },
  globalData: 'I am global data'
})
```
&emsp;&emsp;小程序和Vue以及react等知名框架一样，也有自己的生命周期，在其中可以注册各种各样的的事件。  
接下来我们查看app.json文件：  
```
{
  "pages": [
    "pages/index/index",
    "pages/logs/index"
  ],
  "window": {
    "navigationBarTitleText": "Demo"
  },
  "tabBar": {
    "list": [{
      "pagePath": "pages/index/index",
      "text": "首页"
    }, {
      "pagePath": "pages/logs/logs",
      "text": "日志"
    }]
  },
  "networkTimeout": {
    "request": 10000,
    "downloadFile": 10000
  },
  "debug": true,
  "navigateToMiniProgramAppIdList": [
    "wxe5f52902cf4de896"
  ]
}
```
pages标识项目的所有路由，我们可以轻易知道各个路由下的入口文件在哪里。其他的选项主要控制页面的样式，详见官方文档，[配置小程序](https://developers.weixin.qq.com/miniprogram/dev/framework/config.html#%E5%85%A8%E5%B1%80%E9%85%8D%E7%BD%AE)  
pages文件夹下存放的是小程序的路由。与app.json中pages属性相对应。接下来我们将进入一个具体的路由页分析文件结构，单个路由的文件夹下的文件同根目录下的文件作用类似，index.js控制主逻辑，里面包含该路由下会用到的公共数据和方法，index.json控制路由页的相关配置。index.wxml类似于html,里面有页面的相关内容，通过小程序自己的一套标签来绘制页面，index.wxss则对标css,里面主要负责样式控制。在任何一个平台或框架下，状态控制都是开发者最需要关注的问题之一，小程序的转态同步主要通过this.setData方法完成。具体的解析将在项目实战部分讲解。

# 项目实战
&emsp;&emsp;我们将通过一个简单的例子来作为实战项目。小程序识别码放在文末。这个是笔者自己做的一个小程序demo, 主要功能是计算房屋贷款每月的还款额，可选择还款方式，设置年限、利率以及贷款总额。以下是主页面截图：  
![项目主页面](https://user-gold-cdn.xitu.io/2019/11/29/16eb500ef9bbaa36?w=378&h=669&f=png&s=56639)  
该项目只有一个路由页，放在pages/index目录下。首先我们点开index.wxml文件。  
```
<!--index.wxml-->
<view class="container">
  <view class='main-container'>房贷计算器</view>
  <view>
    <radio-group data-type='loanIn' class="con-flex" bindchange="bindInput">
      <view class='hkFun'>还款方式</view>
      <label class="radio" wx:for="{{loanParten}}">
        <radio value="{{item.name}}" checked="{{item.checked}}"/>{{item.value}}
      </label>
    </radio-group>
  </view>
  <view class='con-flex input-padding'>
    <view>贷款金额</view>
    <view class='con-flex'>
      <input data-type='capital' type='digit' bindinput='bindInput' value='{{capital}}' 
       class='con-input' placeholder='请输入贷款金额'></input>
      <view>万</view>
    </view>
  </view>
  
  <view class='con-flex input-padding'>
    <view>贷款年限</view>
    <view class='con-flex'>
      <input data-type='year' type='digit' bindinput='bindInput' value='{{year}}' 
        class='con-input' placeholder='请输入贷款年限'></input>
      <view>年</view>
    </view>
  </view>

  <view class='con-flex input-intetrest'>
    <view>贷款年利率</view>
    <view class='con-flex'>
      <input data-type='interestRate' type='digit' bindinput='bindInput' value='{{interestRate}}' 
        class='con-input' placeholder='请输入贷款年利率'></input>
      <view>%</view>
    </view>
  </view>

  <view class='con-flex cum-height'>
    <button class='button' type="primary" size="mini" bindtap="primary"> 计算 </button>
    <view class='allInt'>总利息{{allInterest}}万</view>
  </view>

  <view class='left-content'>
    <view class='scroll-title'>
      <view class='title-item title-qi'>期数</view>
      <view class='title-item title-int'>月供</view>
      <view class='title-item title-int'>月供本金</view>
      <view class='title-item title-int'>月供利息</view>
      <view class='title-item'>本金余额</view>
    </view>
    <scroll-view scroll-y class='scroll-content'>
      <view class='con-flex font-item' wx:for='{{detail}}'>
        <view class='item-moun'>{{index + 1}}</view>
        <view class='item-content'>{{item.allSpendMounth}}</view>
        <view class='item-content'>{{item.cap}}</view>
        <view class='item-content'>{{item.interest}}</view>
        <view class='item-content-last'>{{item.remainCap}}</view>
      </view>
    </scroll-view>
  </view>
</view>

```
&emsp;&emsp;这里代码的组织形式同Vue非常类似，我们来分析如下的代码段：  
```
    <radio-group data-type='loanIn' class="con-flex" bindchange="bindInput">
      <view class='hkFun'>还款方式</view>
      <label class="radio" wx:for="{{loanParten}}">
        <radio value="{{item.name}}" checked="{{item.checked}}"/>{{item.value}}
      </label>
    </radio-group>
```
`radio-group`这里表示一个标签类型，微信会渲染出一个基于平台的radio组件，小程序中
需要读取变量的内容使用双重大括号进行包裹，


&emsp;&emsp;首先登陆[微信公众号平台](https://mp.weixin.qq.com/),如果没有账号的话，按照微信平台的要求申请一个。
![](https://user-gold-cdn.xitu.io/2019/11/5/16e3bd1e05e6103c?w=1026&h=397&f=png&s=281568)

![小程序识别码](https://user-gold-cdn.xitu.io/2019/11/29/16eb4fe85d27fedb?w=258&h=258&f=png&s=75371)  

